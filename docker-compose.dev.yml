# Development docker-compose with local directory mounts for easy inspection
# Usage: docker compose -f docker-compose.dev.yml up
#
# All persistent data is stored in .dev-volumes/ directory:
#   .dev-volumes/vault/  - Knowledge vault storage
#   .dev-volumes/claude/ - Claude agent sessions
#   .dev-volumes/data/   - APNs device tokens and other data

services:
  primeai:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: primeai-dev
    ports:
      - "8000:8000"
    env_file:
      - ./.dev-volumes/.env
    volumes:
      # Mount local directories from .dev-volumes/ for easy inspection
      - ./.dev-volumes/vault:/vault
      - ./.dev-volumes/claude:/home/prime/.claude
      - ./.dev-volumes/data:/data
      - ./.dev-volumes/config.yaml:/app/config.yaml:ro
      # Optional: mount source code for live development (uncomment if needed)
      # - ./app:/app/app:ro
    environment:
      # Configuration file location (required)
      - CONFIG_PATH=/app/config.yaml
      # All other secrets loaded from .dev-volumes/.env via env_file directive above
    restart: unless-stopped
    healthcheck:
      test:
        [
          "CMD",
          "bash",
          "-c",
          "cd /app && uv run python -c \"import urllib.request; urllib.request.urlopen('http://localhost:8000/health')\"",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
